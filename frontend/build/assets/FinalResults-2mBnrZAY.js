import{u as E,a as L,b as T,r as f,F as _,A as z,C as I,j as e,M as A,T as C,c as $,d as D,H as M,s as O}from"./index-uOCZsvnr.js";const H=d=>{const l=String(d||"math").trim().toLowerCase();return l.includes("phys")?"physics":l.includes("chem")?"chemistry":"math"},W=d=>{if(!d)return null;const l=String(d).trim().toLowerCase();return l==="easy"?"easy":l==="medium"?"medium":l==="hard"?"hard":null},j=d=>{if(typeof d=="boolean")return d?"pass":"fail";if(!d)return"fail";const l=String(d).trim().toLowerCase();return["pass","passed","success","true"].includes(l)?"pass":["pending"].includes(l)?"pending":"fail"},Y=()=>{const d=E(),l=L(),{toast:v}=T(),S=d.state||{},{studentId:x}=S,[N,P]=f.useState([]),[F,w]=f.useState(!0),[y,R]=f.useState(0);f.useEffect(()=>{(async()=>{const c=x?String(x):sessionStorage.getItem("studentId");if(!c){console.warn("No student ID found"),w(!1);return}try{const{data:s,error:t}=await O.from("results").select("*").eq("student_id",c).order("created_at",{ascending:!1});if(t)throw t;if(s){P(s);const o=s.find(a=>a.concession!==null&&a.concession!==void 0);o&&R(o.concession)}}catch(s){console.error("Error fetching results:",s),v({title:"Error",description:"Failed to load results.",variant:"destructive"})}finally{w(!1)}})()},[x,v]);const p=f.useMemo(()=>{const r={math:{name:"math",displayName:"Mathematics",icon:I,score:0,status:"not_started",levels:{easy:{status:"fail",score:0},medium:{status:"fail",score:0},hard:{status:"fail",score:0}}},physics:{name:"physics",displayName:"Physics",icon:z,score:0,status:"not_started",levels:{easy:{status:"fail",score:0},medium:{status:"fail",score:0},hard:{status:"fail",score:0}}},chemistry:{name:"chemistry",displayName:"Chemistry",icon:_,score:0,status:"not_started",levels:{easy:{status:"fail",score:0},medium:{status:"fail",score:0},hard:{status:"fail",score:0}}}},c={};return[...N].reverse().forEach(s=>{const t=H(s.subject),o=W(s.level);if(!o)return;const a=`${t}-${o}`,n=c[a],u=j(s.result)==="pass";if(!n)c[a]=s;else{const m=j(n.result)==="pass";(u||!m)&&(c[a]=s)}}),Object.keys(r).forEach(s=>{const t=r[s];let o=0,a=0;["easy","medium","hard"].forEach(m=>{const b=c[`${s}-${m}`];if(b){const g=j(b.result);let h=typeof b.score=="number"?b.score:0;h>10&&(h=h/10),t.levels[m]={status:g==="pending"?"fail":g,score:h},g==="pass"&&o++,a+=h,t.status==="not_started"&&(t.status="in_progress")}}),t.score=a/3;const n=t.levels.medium.status==="pass",u=t.levels.hard.status==="pass";n||u?t.status="passed":o>0&&(t.status="in_progress")}),Object.values(r)},[N]),k=p.reduce((r,c)=>r+c.score,0),i=p.every(r=>r.status==="passed");return F?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-4 md:p-8 font-sans transition-colors duration-300",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-emerald-500/5 rounded-full blur-[100px]"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-500/5 rounded-full blur-[100px]"})]}),e.jsx("div",{className:"absolute top-4 right-4 z-50",children:e.jsx(A,{})}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold mb-4 text-slate-900 dark:text-white tracking-tight",children:["Test ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-emerald-500 to-blue-500",children:"Results"})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:"Comprehensive performance analysis across all subjects"})]}),e.jsx("div",{className:`rounded-2xl p-8 mb-12 shadow-xl relative overflow-hidden ${i?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white":"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-full flex items-center justify-center shadow-inner ${i?"bg-white/20 backdrop-blur-md":"bg-slate-100 dark:bg-slate-800"}`,children:i?e.jsx(C,{className:"w-10 h-10 text-white"}):e.jsx($,{className:"w-10 h-10 text-rose-500"})}),e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:`text-3xl font-bold mb-2 ${i?"text-white":"text-slate-900 dark:text-white"}`,children:i?"Excellent! You Passed!":"Test Outcome: Not Passed"}),e.jsx("p",{className:`text-lg opacity-90 ${i?"text-emerald-50":"text-slate-600 dark:text-slate-400"}`,children:i?"You have successfully cleared the admission criteria.":"To pass, you must complete at least the Medium level in all 3 subjects."}),y>0&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-yellow-400/20 backdrop-blur-md border border-yellow-400/30 rounded-full",children:[e.jsx("span",{className:"text-xl",children:"âœ¨"}),e.jsxs("span",{className:"font-bold text-yellow-700 dark:text-yellow-300",children:[y,"% Scholarship Awarded"]})]})]})]}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-40 h-40 transform -rotate-90",children:[e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"currentColor",strokeWidth:"10",fill:"transparent",className:`${i?"text-white/20":"text-slate-200 dark:text-slate-800"}`}),e.jsx("circle",{cx:"80",cy:"80",r:"70",stroke:"currentColor",strokeWidth:"10",fill:"transparent",strokeDasharray:440,strokeDashoffset:440-440*k/30,className:`${i?"text-white":"text-blue-500"}`})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`text-4xl font-bold ${i?"text-white":"text-slate-900 dark:text-white"}`,children:k.toFixed(1)}),e.jsx("span",{className:`text-sm font-medium uppercase ${i?"text-white/80":"text-slate-500"}`,children:"Out of 30"})]})]})})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12",children:p.map(r=>{const c=r.icon,s=r.status==="passed",t={math:{bg:"bg-emerald-50 dark:bg-emerald-900/10",border:"border-emerald-200 dark:border-emerald-800",text:"text-emerald-600 dark:text-emerald-400",bar:"bg-emerald-500"},physics:{bg:"bg-blue-50 dark:bg-blue-900/10",border:"border-blue-200 dark:border-blue-800",text:"text-blue-600 dark:text-blue-400",bar:"bg-blue-500"},chemistry:{bg:"bg-purple-50 dark:bg-purple-900/10",border:"border-purple-200 dark:border-purple-800",text:"text-purple-600 dark:text-purple-400",bar:"bg-purple-500"}}[r.name];return e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-2xl p-6 shadow-lg border ${t.border} flex flex-col`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 rounded-xl ${t.bg}`,children:e.jsx(c,{className:`w-6 h-6 ${t.text}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:r.displayName}),e.jsx("p",{className:"text-xs text-slate-500 font-medium uppercase tracking-wider",children:s?"Completed":"Incomplete"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block text-2xl font-bold text-slate-900 dark:text-white",children:r.score.toFixed(1)}),e.jsx("span",{className:"text-xs text-slate-500",children:"/ 10.0"})]})]}),e.jsx("div",{className:"space-y-4 flex-grow",children:["easy","medium","hard"].map(o=>{const a=r.levels[o],n=a.status==="pass",u=a.status==="fail",m=a.score/10*100;return e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-sm",children:[e.jsx("span",{className:"capitalize text-slate-700 dark:text-slate-300 font-medium",children:o}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-900 dark:text-white font-bold",children:a.score>0?a.score.toFixed(1):"-"}),n&&e.jsx(D,{className:"w-4 h-4 text-emerald-500"}),u&&a.score>0&&e.jsx($,{className:"w-4 h-4 text-rose-500"}),a.score===0&&e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-slate-200 dark:border-slate-700"})]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${n?t.bar:"bg-slate-300 dark:bg-slate-600"}`,style:{width:`${m}%`}})})]},o)})}),e.jsx("div",{className:`mt-6 p-3 rounded-lg text-center text-sm font-medium ${s?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300":"bg-slate-100 dark:bg-slate-800 text-slate-500"}`,children:s?"Subject Cleared":"Requirements Not Met"})]},r.name)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>l("/",{state:{studentId:x}}),className:"px-6 py-4 bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-xl hover:border-emerald-500 dark:hover:border-emerald-500 transition-all flex items-center justify-center gap-2 text-slate-700 dark:text-slate-300 hover:text-emerald-600 dark:hover:text-emerald-400 shadow-lg group",children:[e.jsx(M,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Return Home"})]}),e.jsxs("button",{onClick:()=>{l("/levels",{state:{studentId:x,fromResults:!0}})},className:"px-6 py-4 bg-gradient-to-r from-emerald-600 to-blue-600 text-white rounded-xl hover:shadow-xl transition-all flex items-center justify-center gap-2 shadow-lg group",children:[e.jsx(C,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:i?"View Analysis":"Retry Failed Subjects"})]})]})]})]})};export{Y as default};
