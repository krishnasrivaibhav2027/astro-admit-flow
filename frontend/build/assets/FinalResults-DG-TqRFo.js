import{u as _,a as z,b as B,r as x,R as H,j as e,M as U,C as A,c as C,T as Y,d as P,P as D,B as E,e as K,f as F,H as $}from"./index-BPjiKlfm.js";const I=t=>{if(!t)return null;const r=String(t).trim().toLowerCase();return r==="easy"?"easy":r==="medium"?"medium":r==="hard"?"hard":null},O=t=>{if(typeof t=="boolean")return t?"pass":"fail";if(t==null)return"fail";const r=String(t).trim().toLowerCase();return new Set(["pass","passed","success","completed","true","ok","passed!"]).has(r)?"pass":"fail"},q=(t,r=0,d=10)=>Math.max(r,Math.min(d,Number.isFinite(t)?t:r)),W=()=>{const t=_(),r=z(),{toast:d}=B(),L=t.state||{},{allResults:f=[],studentId:N}=L,[T,p]=x.useState(!0),[m,R]=x.useState(null);x.useEffect(()=>{(async()=>{try{const o=await fetch("http://localhost:8001/api/leaderboard");if(!o.ok)throw new Error("Failed to load leaderboard data");const l=await o.json(),c=localStorage.getItem("userEmail");if(!c){console.warn("No user email found in localStorage"),p(!1);return}let i;l.hard_leaderboard&&Array.isArray(l.hard_leaderboard)&&(i=l.hard_leaderboard.find(j=>j.email.toLowerCase()===c.toLowerCase())),!i&&l.medium_leaderboard&&Array.isArray(l.medium_leaderboard)&&(i=l.medium_leaderboard.find(j=>j.email.toLowerCase()===c.toLowerCase())),i?(console.log("Found user score from backend:",i.total_score),R(i.total_score)):console.warn("User not found in leaderboard. Email:",c),p(!1)}catch(a){console.error("Error fetching actual score:",a),d({title:"Warning",description:"Could not fetch updated score from server. Showing local results.",variant:"default"}),p(!1)}})()},[d]);const u=x.useMemo(()=>Array.isArray(f)?f.map(s=>{try{const a=I(s?.level);if(!a)return null;const o=O(s?.result),l=q(typeof s?.score=="number"?s.score:0),c=s?.criteria&&typeof s.criteria=="object"?s.criteria:{};return{level:a,result:o,score:l,criteria:c}}catch{return null}}).filter(Boolean):[],[f]),v=x.useMemo(()=>{const s={};return u.forEach(a=>s[a.level]=a),s},[u]),g=s=>{const a=v[s];return a?a.result==="pass"?"Passed":"Failed":"Not Attempted"},y=g("easy"),w=g("medium"),S=g("hard"),n=v.medium?.result==="pass",k=u.length,M=u.reduce((s,a)=>s+a.score,0),b=k?M/k:0,h=m!==null?m:b;return H.useEffect(()=>{console.log("Score Debug:",{backendScore:m,calculatedAvgScore:b,displayScore:h,usingBackend:m!==null})},[m,b,h]),["Relevance","Clarity","SubjectUnderstanding","Accuracy","Completeness","CriticalThinking"].forEach(s=>{u.reduce((a,o)=>a+(typeof o.criteria?.[s]=="number"?o.criteria[s]:0),0)}),T?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-purple-50 to-blue-50 dark:from-background dark:via-purple-950/20 dark:to-blue-950/20"}),e.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-primary/20 rounded-full blur-3xl animate-float"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-secondary/20 rounded-full blur-3xl animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-4 right-4 z-50",children:e.jsx(U,{})}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 animate-fade-in",children:[e.jsx(A,{className:`border-4 shadow-elevated ${n?"border-green-500":"border-red-500"}`,children:e.jsxs(C,{className:"p-12 text-center space-y-6",children:[e.jsx("div",{className:`w-24 h-24 mx-auto rounded-full flex items-center justify-center ${n?"bg-gradient-to-br from-green-500 to-emerald-500":"bg-gradient-to-br from-red-500 to-pink-500"} animate-scale-in glow-effect`,children:n?e.jsx(Y,{className:"w-12 h-12 text-white"}):e.jsx(P,{className:"w-12 h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:n?e.jsxs(e.Fragment,{children:["Congratulations! ",e.jsx("span",{className:"gradient-text",children:"You Passed!"})]}):e.jsxs(e.Fragment,{children:["Test ",e.jsx("span",{className:"gradient-text",children:"Not Passed"})]})}),e.jsx("p",{className:"text-xl text-muted-foreground",children:"Admission Test Results"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4 px-8 py-4 rounded-2xl bg-muted/50 border-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Your Average Score"}),e.jsx("p",{className:"text-5xl font-bold gradient-text",children:h.toFixed(2)})]}),e.jsx("div",{className:"text-6xl text-muted-foreground",children:"/"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Out of"}),e.jsx("p",{className:"text-5xl font-bold",children:"10.0"})]})]}),e.jsx(D,{value:Math.max(0,Math.min(100,h/10*100)),className:"h-3"}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Easy:"})," ",y==="Passed"?e.jsx("span",{className:"text-green-600",children:"Passed"}):y==="Not Attempted"?e.jsx("span",{className:"text-gray-500",children:"Not Attempted"}):e.jsx("span",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Medium:"})," ",w==="Passed"?e.jsx("span",{className:"text-green-600",children:"Passed"}):w==="Not Attempted"?e.jsx("span",{className:"text-gray-500",children:"Not Attempted"}):e.jsx("span",{className:"text-red-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Hard:"})," ",S==="Passed"?e.jsx("span",{className:"text-green-600",children:"Passed"}):S==="Not Attempted"?e.jsx("span",{className:"text-gray-500",children:"Not Attempted"}):e.jsx("span",{className:"text-red-600",children:"Failed"})]})]}),n?e.jsxs(E,{className:"text-lg px-6 py-2 bg-green-500 hover:bg-green-600",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Passed"]}):e.jsxs(E,{variant:"destructive",className:"text-lg px-6 py-2",children:[e.jsx(P,{className:"w-5 h-5 mr-2"}),"Not Passed"]})]})}),e.jsx(A,{className:"border-2 bg-card/50 backdrop-blur",children:e.jsxs(C,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:n?"Great Job!":"Keep Trying!"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:n?"Exceptional work! You've successfully completed the medium level which is required to pass. Our team will review your application and contact you with next steps.":"You need to pass the medium level to be considered successful. Review which level(s) show as failed and try again."})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(F,{size:"lg",variant:"outline",className:"flex-1",onClick:()=>r("/",{state:{studentId:N}}),children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Home"]}),e.jsx(F,{size:"lg",variant:"glow",className:"flex-1",onClick:()=>r("/levels",{state:{studentId:N,fromResults:!0}}),children:"Detailed Analysis"})]})]})})]})};export{W as default};
